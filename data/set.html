<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Настройки MTZP</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f6f7fb; }
    .card { background:#fff; border-radius:8px; padding:16px; margin-bottom:16px; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    input, select, button { padding:8px; margin:4px 0; }
    .ok { color:#0a7a2f; }
    .err { color:#b00020; }
  </style>
</head>
<body>
  <h1>Настройки MTZP</h1>
  <p><a href="/">На главную</a></p>

  <div class="card">
    <h3>Параметры подключения</h3>
    <label>Адрес (0-255): <input id="addr" type="number" min="0" max="255" /></label><br />
    <label>Скорость: <select id="baud"></select></label><br />
    <button onclick="saveConfig()">Сохранить</button>
    <div id="result"></div>
  </div>

  <script>
    function loadConfig() {
      fetch('/api/config')
        .then(r => r.json())
        .then(data => {
          document.getElementById('addr').value = data.address;
          const select = document.getElementById('baud');
          select.innerHTML = '';
          data.allowed_baud_rates.forEach(rate => {
            const opt = document.createElement('option');
            opt.value = rate;
            opt.textContent = rate;
            if (rate === data.baud_rate) opt.selected = true;
            select.appendChild(opt);
          });
        });
    }

    function saveConfig() {
      const addr = document.getElementById('addr').value;
      const baud = document.getElementById('baud').value;
      fetch(`/api/config?addr=${encodeURIComponent(addr)}&baud=${encodeURIComponent(baud)}`, { method: 'POST' })
        .then(r => r.json())
        .then(data => {
          document.getElementById('result').innerHTML = data.ok
            ? `<div class="ok">Сохранено: addr=${data.address}, baud=${data.baud_rate}</div>`
            : `<div class="err">Ошибка сохранения</div>`;
        })
        .catch(err => document.getElementById('result').innerHTML = `<div class="err">${err.message}</div>`);
    }

    loadConfig();
  </script>
</body>
</html>
