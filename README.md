MTZP-ESP32 Gateway
üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
ESP32-—à–ª—é–∑ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∑–∞—â–∏—Ç—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ú–¢–ó–ü-2/1200 —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑—å —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º–∏ –∑–∞—â–∏—Ç—ã –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É SLIP —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å RS485 –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ú–¢–ó–ü —á–µ—Ä–µ–∑ RS485 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ SLIP

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π:

–ß—Ç–µ–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (0-276)

–ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–µ–≥–∏—Å—Ç—Ä—ã

–ì—Ä—É–ø–ø–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –¥–æ 16 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∏

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

–¢–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ WiFi –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã

üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: ESP32 (WROOM-32)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–≤—è–∑–∏: RS485 (MAX485 –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π)

–°–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞: 115200 –±–æ–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

–ü—Ä–æ—Ç–æ–∫–æ–ª: SLIP (Serial Line Internet Protocol)

–î–∏–∞–ø–∞–∑–æ–Ω –∞–¥—Ä–µ—Å–æ–≤: 0x01-0xFF (0x00 - —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–π)

–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: Arduino Framework

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:

WiFi (—Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞)

WebServer (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

ArduinoJson (–æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON)

–ü—Ä–æ—Ç–æ–∫–æ–ª: HTTP REST API

üîå –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
text
ESP32                  RS485 Converter               –ú–¢–ó–ü
GPIO16 (RX)    ---->   RO (Receiver Output)
GPIO17 (TX)    ---->   DI (Driver Input)
GPIO4 (DE)     ---->   DE (Driver Enable)   ---->   A (Line A)
                       /RE (Receiver Enable) ---->   B (Line B)
GND            ---->   GND                  ---->   GND
–í–∞–∂–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ç—É—é –ø–∞—Ä—É –¥–ª—è –ª–∏–Ω–∏–π A/B –∏ –æ–±—â–∏–π GND.

‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞
1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
–í —Ñ–∞–π–ª–µ main.cpp –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

cpp
#define MTZP_ADDR 0x12      // –ê–¥—Ä–µ—Å –ú–¢–ó–ü (–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
#define UART_BAUD 115200    // –°–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ WiFi
const char* AP_SSID = "MTZP";
const char* AP_PASS = "12345678";

// –¢–∞–π–º–∞—É—Ç—ã
#define SLIP_TIMEOUT_MS 500
#define BYTE_TIMEOUT_MS 100
2. –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ü–æ–¥–∫–ª—é—á–∏—Ç–µ RS485 –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫ ESP32:

RX ‚Üí GPIO16

TX ‚Üí GPIO17

DE ‚Üí GPIO4

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫ –ú–¢–ó–ü:

A ‚Üí –ö–ª–µ–º–º–∞ A –ú–¢–ó–ü

B ‚Üí –ö–ª–µ–º–º–∞ B –ú–¢–ó–ü

GND ‚Üí –û–±—â–∞—è –∑–µ–º–ª—è

3. –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—à–∏–≤–∫–∏
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ä–µ–¥—É Arduino IDE –∏–ª–∏ PlatformIO

–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É ESP32 –≤ Arduino IDE

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

ArduinoJson

–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ –Ω–∞ ESP32

üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ESP32 —Å–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ "MTZP" (–ø–∞—Ä–æ–ª—å: "12345678"). –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –Ω–µ–π –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ IP-–∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏ —Ä–µ—Å—É—Ä—Å–∞—Ö

–ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ - —á—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –Ω–æ–º–µ—Ä—É —Ä–µ–≥–∏—Å—Ç—Ä–∞

–ó–∞–ø–∏—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∞ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–ì—Ä—É–ø–ø–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ - –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

–¢–µ—Å—Ç —Å–≤—è–∑–∏ - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ú–¢–ó–ü

üîó API Endpoints
GET /api/read?reg=<–Ω–æ–º–µ—Ä>
–ß—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞.

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

json
{
  "reg": 10,
  "value": 12345,
  "ok": true,
  "hex_value": "3039"
}
POST /api/write?reg=<–Ω–æ–º–µ—Ä>&val=<–∑–Ω–∞—á–µ–Ω–∏–µ>
–ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ä–µ–≥–∏—Å—Ç—Ä.

GET /api/read_multiple?regs=<–Ω–æ–º–µ—Ä–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é>
–ì—Ä—É–ø–ø–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤.

GET /api/test
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–∏ —Å –ú–¢–ó–ü.

GET /api/status
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã.

üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
1. –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
text
–ß—Ç–µ–Ω–∏–µ —Å–µ—Ä–∏–π–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞: —Ä–µ–≥–∏—Å—Ç—Ä 10
–ß—Ç–µ–Ω–∏–µ –¥–∞—Ç—ã –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è: —Ä–µ–≥–∏—Å—Ç—Ä 11
–ù–∞–ø—Ä—è–∂–µ–Ω–∏—è —Ñ–∞–∑: —Ä–µ–≥–∏—Å—Ç—Ä—ã 33, 34, 35
–¢–æ–∫–∏ —Ñ–∞–∑: —Ä–µ–≥–∏—Å—Ç—Ä—ã 41, 42, 43
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥—Ä—É–ø–ø–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
1. –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ú–¢–ó–ü
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∞–¥—Ä–µ—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è RS485

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±–º–µ–Ω–∞ (UART_BAUD)

–£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

2. –û—à–∏–±–∫–∏ CRC
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –ª–∏–Ω–∏–∏ —Å–≤—è–∑–∏

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ CRC

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ä–æ–≤–Ω–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ RS485

3. –ü—Ä–æ–±–ª–µ–º—ã —Å WiFi
–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ ESP32

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è API

üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
MIT License

ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ
–ï—Å–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–π—Ç–µ Issue –∏–ª–∏ Pull Request –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

–í–Ω–∏–º–∞–Ω–∏–µ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ —Å –ú–¢–ó–ü —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ—Ö–Ω–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —ç–ª–µ–∫—Ç—Ä–æ—É—Å—Ç–∞–Ω–æ–≤–æ–∫.
